generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  tag           String         @unique
  name          String
  surname       String
  email         String         @unique
  phone         String
  location      String?
  gender        String?
  biography     String?
  password      String
  salt          String?
  isLawApproved Boolean        @default(false)
  photoKey      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  roles         Role[]         @relation("UserRoles") // Bir kullanıcı birden fazla role sahip olabilir
  businesses    Business[]
  profile       Profile?
  favorites     Favorite[]
  refreshTokens RefreshToken[]

  businessWorkers BusinessWorker[] // bir kullanıcı birden fazla çalışan olabilir
  businessRatings BusinessRating[]


}

enum UserRole {
  super_admin
  admin
  store_owner
  customer
}

model Role {
  id     String   @id @default(uuid())
  role   UserRole
  userId String
  user   User     @relation(fields: [userId], references: [id], name: "UserRoles")

  @@index([userId])
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model Profile {
  id                String    @id @default(uuid())
  userId            String    @unique
  bio               String?
  birthDate         DateTime?
  avatarUrl         String?
  isProfileComplete Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  user      User       @relation(fields: [userId], references: [id])
  favorites Favorite[] @relation("ProfileFavorites")
  //appointments      Appointment[]  // Henüz Appointment modeli eklenmediyse şimdilik yoruma alabilirsin
}

model Business {
  id          String    @id @default(uuid())
  ownerId     String
  owner       User      @relation(fields: [ownerId], references: [id])
  name        String
  description String?
  location    String
  address     String?
  latitude    Float? // konum servisleri için
  longitude   Float?
  phone       String?
  email       String?
  website     String?
  photoUrl    String? // kapak/ana görsel
  isApproved  Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  isDeleted   Boolean   @default(false)
  deletedAt   DateTime?
  deletedBy   String?

  businessTypeId String?
  businessType   BusinessType? @relation(fields: [businessTypeId], references: [id])
  services        BusinessService[] 
  workers BusinessWorker[]
  ratings BusinessRating[]



}

model BusinessType {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // İlişki: Bir tür, birçok mağazada kullanılabilir
  businesses Business[]
}

model BusinessService {
  id          String   @id @default(uuid())
  businessId  String
  name        String
  price       Float
  duration    Int       // dakika cinsinden hizmet süresi
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  business Business @relation(fields: [businessId], references: [id])
}

model WorkerType {
  id          String             @id @default(uuid())
  name        String             @unique
  description String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  businessWorkers BusinessWorker[]

}

model BusinessWorker {
  id           String      @id @default(uuid())
  businessId   String
  workerTypeId String
  userId       String?     // Opsiyonel: sistemde kayıtlı kullanıcı ile eşleştirilebilir
  name         String
  photoUrl     String?
  bio          String?
  isActive     Boolean     @default(true)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  business     Business    @relation(fields: [businessId], references: [id])
  workerType   WorkerType  @relation(fields: [workerTypeId], references: [id])
  user         User?       @relation(fields: [userId], references: [id])
}

model BusinessRating {
  id          String   @id @default(uuid())
  userId      String
  businessId  String
  rating      Int      // 1-5 arasında olmalı
  createdAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id])
  business    Business @relation(fields: [businessId], references: [id])

  @@unique([userId, businessId])
}

model Favorite {
  id         String   @id @default(uuid())
  userId     String
  businessId String
  profileId  String? // opsiyonel olabilir
  createdAt  DateTime @default(now())

  user    User     @relation(fields: [userId], references: [id])
  profile Profile? @relation(fields: [profileId], references: [id], name: "ProfileFavorites")

  // business   Business @relation(fields: [businessId], references: [businessId])

  @@unique([userId, businessId])
}
